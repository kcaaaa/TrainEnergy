# 高铁站节能降耗管理系统 - 单站能耗分析模块设计文档

## 1. 功能概述
单站能耗分析模块是高铁站节能降耗管理系统的核心模块之一，负责对单个高铁站的能耗情况进行全面、深入的分析，提供实时监控、趋势分析、分类分析、区域对比和设备能耗详情等功能，帮助管理者识别能耗异常和优化机会。

### 1.1 主要功能
- 实时监控
- 趋势分析（含小时级分析特性）
- 分类分析
- 区域对比
- 设备能耗详情

### 1.2 功能目标
实现对单个高铁站能耗的全方位分析，提供多维度的数据展示和深入洞察，为能耗管理和节能决策提供科学依据。

### 1.3 模式区分与展示原则
- **模式入口**：右上角提供显式模式切换（单站/多站），切换后立即刷新当前页面数据源与可见组件。
- **单站模式可见性**：仅展示与当前站点相关的功能与图表（实时监控、趋势分析、分类分析、区域对比、设备详情）；隐藏或禁用多站聚合、跨站对比、全站排行等组件与菜单入口。
- **多站模式隔离**：进入多站模式时，隐藏本文件定义的单站专属组件；多站功能在独立的多站模块内实现。
- **状态保持**：模式状态写入会话存储，刷新后保持最近一次选择；切换时重置查询条件（站点、时间、分类）以避免交叉污染。

## 2. 输入/输出

### 2.1 输入
- 站点选择（要分析的高铁站）
- 时间范围选择（日/周/月/年/自定义）
- 能耗分类选择（设备类型/区域分类）
- 查询条件（能耗类型、设备类别、区域等）
- 对比维度选择（同比/环比）

### 2.2 输出
- 实时能耗数据展示
- 能耗趋势图表
- 能耗分类占比图表
- 区域能耗对比图表
- 设备能耗详情列表
- 能耗异常告警信息
- 能耗分析报告

## 3. 功能逻辑

### 3.1 实时监控
1. **数据展示**：
   - 显示当前能耗总量和主要能耗指标
   - 实时展示各分类能耗数据（照明、空调、暖通等）
   - 以仪表盘形式展示关键能耗指标

2. **异常预警**：
   - 实时监测能耗数据
   - 当能耗超过设定阈值时，触发告警
   - 在界面上显示告警信息，并支持点击查看详情

3. **数据刷新**：
   - 实时数据自动刷新（默认5分钟/次，可配置）
   - 支持手动刷新数据

### 3.2 趋势分析
1. **时间维度分析**：
   - **按天查询**：自动根据小时拆分能耗数据，提供24小时逐小时能耗分析
   - **按周查询**：按天拆分展示7天能耗数据，支持工作日/周末对比分析
   - **按月查询**：按天或按周拆分展示能耗数据，支持与历史月份对比
   - **按年查询**：按月拆分展示能耗数据，支持与历史年份对比

2. **能耗对比功能**：
   - 支持同比分析（与去年同期对比）
   - 支持环比分析（与上一周期对比）
   - 提供对比图表和差值数据

3. **小时级分析特性**：
   - 展示每小时能耗峰值与谷值，自动标记异常波动时段
   - 支持将小时数据与列车时刻表、运营场景关联分析
   - 提供小时级能耗预警功能，实时监测能耗异常
   - 支持导出小时级能耗明细数据

4. **自定义时间范围**：
   - 支持用户自定义任意时间范围的查询
   - 提供快捷时间选择（最近7天、最近30天等）

### 3.3 分类分析
1. **能耗分类展示**：
   - 按设备类型（照明、空调、暖通等）展示能耗占比
   - 按区域分类（候车厅、站台、办公区等）展示能耗占比
   - 以饼图、柱状图等形式直观展示能耗分布

2. **分类能耗趋势**：
   - 展示各分类能耗的时间趋势
   - 支持多分类对比展示

3. **分类能耗详情**：
   - 点击分类可查看该分类下的详细能耗数据
   - 支持向下钻取查看更细粒度的分类数据

### 3.4 区域对比
1. **区域能耗对比**：
   - 展示不同区域（候车厅、站台、办公区等）的能耗情况
   - 支持多区域对比分析
   - 以柱状图、热力图等形式展示区域能耗分布

2. **区域能耗排名**：
   - 按能耗总量或单位面积能耗进行区域排名
   - 支持升序/降序排列

3. **区域能耗详情**：
   - 点击区域可查看该区域内的详细能耗数据
   - 支持查看区域内的设备能耗分布

### 3.5 设备能耗详情
1. **设备能耗列表**：
   - 展示所有设备的能耗数据
   - 支持按能耗大小排序
   - 显示设备名称、型号、能耗值等信息

2. **设备能耗趋势**：
   - 展示单台设备的能耗时间趋势
   - 支持多设备对比分析

3. **设备能耗异常检测**：
   - 自动检测设备能耗异常情况
   - 显示设备能耗异常告警

## 4. 数据流向

### 4.1 实时监控数据流向
1. 数据采集模块 → 实时数据库 → 实时监控界面展示
2. 实时数据库 → 异常检测算法 → 告警信息 → 实时监控界面展示

### 4.2 趋势分析数据流向
1. 用户选择时间范围 → 前端发送查询请求 → 后端API处理 → 历史数据库查询 → 返回分析结果 → 前端展示趋势图表

2. 小时级分析数据流向：
   - 用户选择按天查询 → 前端发送小时级查询请求 → 后端API处理 → 小时级数据库查询 → 与列车时刻表/运营场景关联分析 → 返回分析结果 → 前端展示小时级趋势图表

### 4.3 分类分析数据流向
1. 用户选择能耗分类 → 前端发送查询请求 → 后端API处理 → 分类数据库查询 → 返回分类分析结果 → 前端展示分类占比图表

### 4.4 区域对比数据流向
1. 用户选择对比区域 → 前端发送查询请求 → 后端API处理 → 区域数据库查询 → 返回区域对比结果 → 前端展示区域对比图表

### 4.5 设备能耗详情数据流向
1. 用户选择设备 → 前端发送查询请求 → 后端API处理 → 设备能耗数据库查询 → 返回设备能耗详情 → 前端展示设备能耗列表和趋势

## 5. 功能点击交互

### 5.1 实时监控页面
1. **页面布局**：
   - 顶部：站点选择、实时数据刷新时间
   - 中部：能耗总量仪表盘、主要能耗指标卡片
   - 下部：各分类能耗实时趋势图、异常告警列表

2. **交互流程**：
   - 点击能耗指标卡片 → 钻取查看该指标的详细信息
   - 点击异常告警 → 查看告警详情
   - 点击刷新按钮 → 手动刷新实时数据

### 5.2 趋势分析页面
1. **页面布局**：
   - 顶部：时间范围选择器、对比维度选择器
   - 中部：能耗趋势图表（折线图）
   - 下部：数据表格、异常波动标记

2. **交互流程**：
   - 选择时间维度（日/周/月/年） → 图表自动更新
   - 选择同比/环比 → 图表显示对比数据
   - 点击图表上的数据点 → 显示详细数据 tooltip
   - 点击异常波动标记 → 查看异常详情

### 5.3 分类分析页面
1. **页面布局**：
   - 顶部：能耗分类选择器、时间范围选择器
   - 中部：能耗分类占比图表（饼图/环形图）
   - 下部：各分类能耗趋势图（柱状图）

2. **交互流程**：
   - 选择能耗分类类型 → 图表自动更新
   - 点击饼图扇形区域 → 显示该分类的详细信息
   - 点击柱状图 → 钻取查看更细粒度的分类数据

### 5.4 区域对比页面
1. **页面布局**：
   - 顶部：区域选择器、时间范围选择器
   - 中部：区域能耗对比图表（柱状图/热力图）
   - 下部：区域能耗排名列表

2. **交互流程**：
   - 选择对比区域 → 图表自动更新
   - 点击柱状图 → 查看该区域的详细能耗数据
   - 点击排名列表项 → 钻取查看该区域内的设备能耗分布

### 5.5 设备能耗详情页面
1. **页面布局**：
   - 顶部：设备类型选择器、时间范围选择器
   - 中部：设备能耗列表（表格形式）
   - 下部：选中设备的能耗趋势图

2. **交互流程**：
   - 选择设备类型 → 列表自动筛选
   - 点击列表中的设备 → 底部图表显示该设备的能耗趋势
   - 点击能耗值 → 查看该设备的详细运行数据

### 5.6 模式切换交互
1. **入口位置**：右上角模式切换器（单选按钮组或下拉），文案“单站分析 / 多站分析”。
2. **切换逻辑**：
   - 进入单站模式：仅加载当前站点数据源，隐藏跨站对比与全站排行组件；清空多站相关缓存状态。
   - 进入多站模式：跳转/加载多站分析模块，隐藏单站专属组件；清空单站的站点选择与筛选缓存，避免误用。
3. **权限拦截**：根据角色（见系统管理模块文档）校验可见模式；无权限的模式入口置灰或不展示。
4. **提示反馈**：切换时显示轻提示“已切换至单站/多站模式，筛选条件已重置”，并触发加载动画。

## 6. 功能字段

### 6.1 实时能耗数据表
| 字段名称 | 数据类型 | 长度 | 约束条件 | 描述 |
|---------|---------|------|--------|------|
| monitoring_id | 字符串 | 32 | 主键，唯一 | 监控记录ID |
| station_id | 字符串 | 32 | 非空 | 站点ID |
| monitoring_time | 日期时间 | - | 非空 | 监控时间 |
| total_energy | 数值 | - | 非空 | 总能耗值 |
| electricity_energy | 数值 | - | 非空 | 电耗值 |
| water_energy | 数值 | - | 非空 | 水耗值 |
| gas_energy | 数值 | - | 非空 | 燃气耗值 |
| air_conditioning_energy | 数值 | - | 非空 | 空调能耗 |
| lighting_energy | 数值 | - | 非空 | 照明能耗 |
| hvac_energy | 数值 | - | 非空 | 暖通能耗 |
| is_alarm | 布尔值 | - | 非空 | 是否告警 |

### 6.2 小时级能耗数据表
| 字段名称 | 数据类型 | 长度 | 约束条件 | 描述 |
|---------|---------|------|--------|------|
| hourly_energy_id | 字符串 | 32 | 主键，唯一 | 小时能耗记录ID |
| station_id | 字符串 | 32 | 非空 | 站点ID |
| record_time | 日期时间 | - | 非空 | 记录时间 |
| hour_of_day | 整数 | - | 非空 | 一天中的小时(0-23) |
| energy_value | 数值 | - | 非空 | 能耗值 |
| energy_type | 字符串 | 20 | 非空 | 能耗类型(电/水/燃气) |
| is_peak | 布尔值 | - | 非空 | 是否峰值 |
| is_valley | 布尔值 | - | 非空 | 是否谷值 |
| is_abnormal | 布尔值 | - | 非空 | 是否异常 |
| operation_scenario | 字符串 | 50 | 可空 | 运营场景 |

### 6.3 能耗分类表
| 字段名称 | 数据类型 | 长度 | 约束条件 | 描述 |
|---------|---------|------|--------|------|
| category_id | 字符串 | 32 | 主键，唯一 | 分类ID |
| category_name | 字符串 | 50 | 非空 | 分类名称 |
| category_type | 字符串 | 20 | 非空 | 分类类型(设备/区域) |
| parent_category_id | 字符串 | 32 | 可空 | 父分类ID |
| description | 文本 | - | 可空 | 分类描述 |

### 6.4 设备能耗表
| 字段名称 | 数据类型 | 长度 | 约束条件 | 描述 |
|---------|---------|------|--------|------|
| device_energy_id | 字符串 | 32 | 主键，唯一 | 设备能耗记录ID |
| device_id | 字符串 | 32 | 非空 | 设备ID |
| record_time | 日期时间 | - | 非空 | 记录时间 |
| energy_value | 数值 | - | 非空 | 能耗值 |
| energy_type | 字符串 | 20 | 非空 | 能耗类型 |
| running_status | 字符串 | 20 | 非空 | 运行状态 |

## 7. 异常情况及处理

### 7.1 数据异常
- **场景**：采集的能耗数据异常（如负值、超出合理范围）
- **处理**：
  - 系统自动标记异常数据
  - 在界面上以特殊颜色显示异常数据点
  - 提供数据异常告警
  - 支持数据修正功能

### 7.2 查询异常
- **场景**：用户查询的时间范围无数据
- **处理**：
  - 系统显示"无数据"提示
  - 建议用户调整查询条件

### 7.3 性能异常
- **场景**：大量数据查询导致页面加载缓慢
- **处理**：
  - 显示加载状态和进度
  - 提供数据分页功能
  - 对大数据量进行采样处理

### 7.4 告警异常
- **场景**：误告警或漏告警
- **处理**：
  - 支持告警规则配置和优化
  - 提供告警屏蔽功能
  - 记录告警历史，支持分析和优化

## 8. 性能要求

### 8.1 响应时间
- 实时监控页面加载时间：≤2秒
- 趋势分析图表加载时间：≤3秒
- 分类分析和区域对比加载时间：≤2秒
- 设备能耗详情加载时间：≤2秒

### 8.2 并发处理
- 支持≥100个并发用户同时访问单站能耗分析功能
- 支持≥50个并发用户同时进行小时级能耗分析

### 8.3 数据更新
- 实时数据更新频率：≤5分钟/次（可配置）
- 历史数据查询响应时间：≤5秒

### 8.4 数据容量
- 支持存储≥5年的小时级能耗数据
- 支持管理≥10,000台设备的能耗数据

## 9. 安全要求

### 9.1 访问控制
- 基于角色的访问控制（RBAC）
- 单站能耗分析功能对所有授权用户开放
- 敏感操作需要权限验证

### 9.2 数据保护
- 能耗数据传输采用加密方式
- 能耗数据定期备份
- 严格的数据库访问权限控制

### 9.3 审计日志
- 记录所有能耗分析操作
- 记录操作人、操作时间、操作内容

## 10. 测试点

### 10.1 功能测试
- 实时监控功能测试
- 趋势分析功能测试（含小时级分析）
- 分类分析功能测试
- 区域对比功能测试
- 设备能耗详情功能测试
- 异常告警功能测试
- 模式切换与可见性测试：验证单站模式隐藏多站功能，多站模式隐藏单站组件；验证切换后状态重置与数据源刷新。

### 10.2 异常测试
- 数据异常处理测试
- 查询无数据测试
- 性能异常处理测试
- 告警异常处理测试

### 10.3 性能测试
- 页面加载性能测试
- 大数据量查询性能测试
- 并发用户访问测试
- 实时数据更新性能测试

## 11. 依赖关系

### 11.1 内部依赖
- 数据采集模块（能耗数据来源）
- 系统管理模块（用户权限控制）
- 设备与系统管理模块（设备信息）

### 11.2 外部依赖
- 数据库系统（能耗数据存储）
- 图表库（数据可视化）
- 时间序列数据库（高效处理时序数据）

## 12. 变更记录

| 版本 | 变更日期 | 变更内容 | 变更人 | 审核人 |
|------|---------|---------|-------|-------|
| V1.0 | 2025-12-23 | 单站能耗分析模块设计文档初稿 | 系统设计师 | |
| V1.1 | 2025-12-24 | 增加单站/多站模式切换入口与可见性规则，补充权限校验与测试点 | 系统设计师 | |
