# 高铁站节能降耗管理系统 - 数据采集模块设计文档

**模块名称**：数据采集

**版本号**：v1.0

**修订日期**：2025-12-23

**编写人**：全流程产品技术负责人

## 1. 功能概述

### 1.1 功能描述
本模块负责高铁站能耗数据的采集、导入、验证和预处理工作，是整个系统的数据来源基础。通过实时采集和历史导入两种方式获取能耗数据，并对数据进行完整性和准确性验证，确保数据质量，为后续的分析和决策提供可靠的数据支持。

### 1.2 设计目标
- 实现能耗数据的实时采集和历史导入
- 确保采集数据的完整性和准确性
- 支持灵活的数据采集频率设置
- 提供数据质量监控和异常处理机制
- 建立高效的数据存储和管理体系

### 1.3 适用范围
适用于系统管理员和技术人员，用于配置数据采集参数、管理数据采集流程、验证数据质量等。

## 2. 输入输出

### 2.1 输入数据
| 输入项 | 数据类型 | 描述 | 来源 | 约束条件 |
|-------|---------|------|------|--------|
| 实时能耗数据 | 数值型 | 传感器和智能电表采集的数据 | 硬件设备 | 必须为非负数值 |
| 历史能耗数据 | 数值型/文本型 | 批量导入的历史能耗记录 | 外部文件/系统 | 必须符合导入格式 |
| 采集参数配置 | 数值型/布尔型 | 数据采集频率等参数 | 用户配置 | 必须为有效参数 |
| 验证规则配置 | 布尔型/枚举型 | 数据验证规则 | 用户配置 | 必须为有效规则 |

### 2.2 输出结果
| 输出项 | 数据类型 | 描述 | 展示方式 |
|-------|---------|------|---------|
| 采集数据记录 | 数值型/文本型 | 经过验证的能耗数据 | 数据存储、系统内部接口 |
| 数据验证结果 | 布尔型/文本型 | 数据验证通过/失败信息 | 日志记录、错误报告 |
| 数据质量报告 | 数值型/图表型 | 数据质量统计信息 | 报告、图表 |
| 采集异常告警 | 文本型 | 数据采集异常信息 | 告警通知、日志记录 |

## 3. 功能逻辑

### 3.1 核心流程

#### 3.1.1 实时数据采集流程
1. 系统按照配置的采集频率向传感器和智能电表发送采集请求
2. 硬件设备响应并返回实时能耗数据
3. 系统对采集的数据进行格式转换和预处理
4. 对数据进行完整性和准确性验证
5. 验证通过的数据存储到数据库
6. 验证失败的数据记录到错误日志并触发告警

#### 3.1.2 历史数据导入流程
1. 用户选择历史数据文件并上传
2. 系统解析数据文件并进行格式验证
3. 对解析后的数据进行完整性和准确性验证
4. 验证通过的数据批量存储到数据库
5. 验证失败的数据生成错误报告并提示用户

### 3.2 子功能说明

#### 3.2.1 实时数据采集
- **功能描述**：通过传感器和智能电表实时采集能耗数据
- **采集方式**：自动定时采集（频率可配置）
- **数据类型**：电量、水量、燃气量等
- **接口协议**：支持主流工业协议（如Modbus、BACnet等）
- **异常处理**：采集失败时自动重试，多次失败后触发告警

#### 3.2.2 历史数据导入
- **功能描述**：支持批量导入历史能耗数据
- **支持格式**：Excel、CSV、JSON等
- **导入方式**：文件上传、接口调用
- **数据映射**：支持自定义字段映射
- **冲突处理**：支持覆盖或跳过已有数据

#### 3.2.3 数据验证
- **功能描述**：对采集和导入的数据进行完整性和准确性验证
- **验证规则**：
  - 数据完整性验证（必填字段检查）
  - 数据格式验证（数值范围、日期格式等）
  - 业务规则验证（能耗数值合理性检查）
  - 重复数据检查
- **验证结果**：通过/失败标记，失败原因记录

#### 3.2.4 数据预处理
- **功能描述**：对原始数据进行清洗和转换
- **处理内容**：
  - 单位转换（如将度转换为kWh）
  - 缺失值处理（插值、默认值等）
  - 异常值处理（过滤、标记等）
  - 数据聚合（如按小时、天汇总）

#### 3.2.5 采集参数配置
- **功能描述**：配置数据采集相关参数
- **配置项**：
  - 数据采集频率（默认5分钟）
  - 重试次数和间隔
  - 数据缓存策略
  - 接口连接参数

### 3.3 业务规则
- 实时数据采集频率范围：1分钟-60分钟
- 能耗数值必须为非负数值
- 数据时间必须为有效时间格式
- 历史数据导入时必须指定数据来源和采集方式
- 数据验证失败率超过10%时触发告警

## 4. 数据流向

### 4.1 数据流程图
硬件设备/外部系统 → 数据采集模块 → 数据验证 → 数据预处理 → 数据存储 → 各业务模块

### 4.2 数据存储
- 原始数据：临时存储原始采集数据，保留时间可配置
- 验证后数据：存储经过验证和预处理的能耗数据
- 错误数据：存储验证失败的数据和错误原因
- 采集日志：记录数据采集过程和状态

### 4.3 数据关联
- 与设备与系统管理模块关联：获取设备和系统信息
- 与能耗分析模块关联：提供分析所需的能耗数据
- 与能耗分析预警模块关联：提供预警分析所需的实时数据
- 与系统管理模块关联：获取系统配置参数

## 5. 功能交互

### 5.1 界面原型

#### 5.1.1 数据采集配置界面
- **布局**：表单布局，包含采集频率、重试次数、接口参数等配置项
- **组件**：输入框、下拉选择框、开关按钮、保存按钮

#### 5.1.2 历史数据导入界面
- **布局**：文件上传区域+字段映射配置+导入日志
- **组件**：文件上传组件、表格、下拉选择框、导入按钮、日志列表

#### 5.1.3 数据质量监控界面
- **布局**：统计图表+数据质量指标+异常列表
- **组件**：饼图/柱状图、数字卡片、表格、筛选器

### 5.2 交互流程

#### 5.2.1 数据采集配置流程
1. 用户进入数据采集配置界面
2. 配置数据采集频率、重试次数等参数
3. 点击保存按钮
4. 系统验证配置参数的有效性
5. 验证通过后更新配置并提示成功

#### 5.2.2 历史数据导入流程
1. 用户进入历史数据导入界面
2. 选择数据文件并上传
3. 系统解析文件并显示数据预览
4. 用户配置字段映射关系
5. 点击导入按钮
6. 系统进行数据验证和导入
7. 显示导入结果和错误日志

#### 5.2.3 数据质量监控流程
1. 用户进入数据质量监控界面
2. 查看数据质量统计图表和指标
3. 筛选查看特定时间范围的数据质量
4. 点击异常数据查看详细信息
5. 根据异常信息进行相应处理

### 5.3 操作说明
- **配置采集参数**：在数据采集配置界面输入或选择参数值，点击保存
- **导入历史数据**：选择数据文件上传，配置字段映射，点击导入
- **查看数据质量**：进入数据质量监控界面，查看统计信息和异常数据
- **处理异常数据**：根据异常提示信息，检查数据源或调整验证规则
- **导出数据报告**：在数据质量监控界面点击导出按钮，选择报告格式

## 6. 功能字段

### 6.1 核心字段定义
| 字段名称 | 数据类型 | 长度 | 约束条件 | 描述 |
|---------|---------|------|--------|------|
| data_id | 字符串 | 32 | 主键，唯一 | 数据ID |
| station_id | 字符串 | 32 | 外键，非空 | 高铁站ID |
| data_time | 日期时间型 |  | 非空 | 数据时间 |
| energy_type | 字符串 | 20 | 非空 | 能耗类型（电量/水量/燃气量等） |
| energy_value | 数值型 | 10,2 | 非空 | 能耗数值 |
| unit | 字符串 | 10 | 非空 | 单位 |
| device_id | 字符串 | 32 | 可空 | 设备ID（仅关联大型设备） |
| area_id | 字符串 | 32 | 非空 | 区域ID |
| energy_category_id | 字符串 | 32 | 非空 | 能耗分类ID |
| collection_method | 字符串 | 10 | 非空 | 采集方式（实时/历史） |
| validation_status | 字符串 | 10 | 非空 | 验证状态（通过/失败） |
| collection_time | 日期时间型 |  | 非空 | 采集时间 |

### 6.2 扩展字段
| 字段名称 | 数据类型 | 长度 | 约束条件 | 描述 |
|---------|---------|------|--------|------|
| device_operation_mode | 字符串 | 20 | 可空 | 设备运行模式（正常/节能/值班/应急） |
| system_load_rate | 数值型 | 5,2 | 可空 | 系统负载率（0-100%） |
| related_operation_scene | 字符串 | 50 | 可空 | 关联运营场景 |
| validation_error | 文本型 | 200 | 可空 | 验证失败原因 |
| data_source | 字符串 | 50 | 可空 | 数据来源 |
| collection_status | 字符串 | 20 | 非空 | 采集状态（成功/失败/重试中） |

## 7. 异常情况处理

### 7.1 异常类型
- 采集设备通信异常：无法连接到传感器或智能电表
- 数据格式异常：采集的数据格式不符合要求
- 数据验证失败：数据不符合业务规则或完整性要求
- 数据导入失败：历史数据文件解析或导入失败
- 存储异常：数据无法写入数据库

### 7.2 异常处理机制
- **采集设备通信异常**：自动重试采集（次数可配置），多次失败后触发告警
- **数据格式异常**：记录异常数据和原因，跳过该条数据并继续采集
- **数据验证失败**：标记数据为验证失败，记录失败原因，触发数据质量告警
- **数据导入失败**：生成详细的错误报告，提示用户具体失败原因
- **存储异常**：将数据缓存到本地，待存储恢复后重新写入，同时触发告警

### 7.3 容错设计
- 实现断点续传功能，确保数据不丢失
- 建立数据缓存机制，应对网络波动或存储故障
- 采用幂等设计，避免重复数据
- 建立完善的日志记录机制，便于问题追踪和分析

## 8. 性能要求

### 8.1 响应时间
- 实时数据采集响应时间：不超过1秒
- 历史数据导入速率：不低于1000条/秒
- 数据验证处理时间：不超过500毫秒/条
- 数据存储响应时间：不超过200毫秒/条

### 8.2 资源占用
- CPU使用率：正常情况下不超过40%
- 内存使用率：正常情况下不超过50%
- 网络带宽：采集数据传输带宽不超过1Mbps
- 存储容量：支持至少1年的原始数据存储

## 9. 安全要求

### 9.1 权限控制
- 只有系统管理员和授权技术人员可以配置数据采集参数
- 只有系统管理员可以导入历史数据
- 数据采集接口需要身份验证和授权

### 9.2 数据安全
- 数据传输采用加密协议（如HTTPS、SSL等）
- 敏感数据存储加密
- 建立数据访问审计机制
- 定期备份数据，确保数据可恢复

## 10. 测试要点

### 10.1 功能测试
- 实时数据采集功能测试（不同频率下的数据采集）
- 历史数据导入功能测试（不同格式和大小的文件）
- 数据验证功能测试（各种验证规则的有效性）
- 数据预处理功能测试（单位转换、缺失值处理等）
- 异常处理功能测试（通信异常、数据格式错误等）

### 10.2 性能测试
- 高并发下的实时数据采集性能测试
- 大数据量的历史数据导入性能测试
- 数据验证和预处理的性能测试
- 系统资源占用测试

### 10.3 兼容性测试
- 与不同类型传感器和智能电表的兼容性测试
- 不同数据格式的导入兼容性测试
- 与现有能耗监测系统的集成测试

## 11. 依赖关系

### 11.1 内部依赖
- 系统管理模块：提供用户权限管理和系统配置
- 设备与系统管理模块：提供设备和系统信息
- 数据存储模块：提供数据存储和查询服务

### 11.2 外部依赖
- 传感器和智能电表：提供实时能耗数据
- 外部数据系统：提供历史能耗数据
- 工业通信协议库：实现与硬件设备的通信

## 12. 变更记录

| 版本号 | 变更日期 | 变更内容 | 变更人 |
|-------|---------|---------|--------|
| v1.0 | 2025-12-23 | 初始版本 | 全流程产品技术负责人 |