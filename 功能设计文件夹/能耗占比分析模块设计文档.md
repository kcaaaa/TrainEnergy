# 高铁站节能降耗管理系统 - 能耗占比分析模块设计文档

## 1. 功能概述
能耗占比分析模块是高铁站节能降耗管理系统的核心分析模块之一，负责统计高铁站不同能源类型、不同区域、不同设备类型以及不同系统级的能耗占比，支持从全站→系统→区域→设备的多级能耗拆解分析，帮助管理者识别主要能耗来源和节能潜力区域。

### 1.1 主要功能
- 能源类型能耗占比分析
- 区域能耗占比分析
- 设备类型能耗占比分析
- 系统级能耗占比分析（核心设备系统）
- 多级能耗拆解分析
- 节能潜力自动标注

### 1.2 功能目标
实现对高铁站能耗结构的全面分析，提供多维度的能耗占比视图，支持深入的数据下钻，帮助管理者快速识别主要能耗来源和节能机会。

## 2. 输入/输出

### 2.1 输入
- 时间范围选择（日/周/月/年/自定义）
- 能源类型选择（电力/燃气/水等）
- 统计维度选择（能源类型/区域/设备类型/系统级）
- 系统级分析维度选择（空调通风/电梯扶梯/照明等）
- 下钻操作（点击图表区域或使用导航树）

### 2.2 输出
- 能耗占比分析图表（饼图/环形图）
- 多级能耗拆解结果
- 能耗占比数据表格
- 节能潜力标注和建议
- 能耗占比分析报告

## 3. 功能逻辑

### 3.1 能源类型能耗占比分析
1. **数据统计**：
   - 统计选定时间范围内不同能源类型的能耗总量
   - 计算各能源类型的能耗占比

2. **数据展示**：
   - 以饼图或环形图形式展示能源类型能耗占比
   - 图表旁边显示具体数值和百分比
   - 支持按时间周期（日/周/月/年）切换

### 3.2 区域能耗占比分析
1. **数据统计**：
   - 统计选定时间范围内不同区域的能耗总量
   - 计算各区域的能耗占比

2. **数据展示**：
   - 以饼图或环形图形式展示区域能耗占比
   - 支持多区域对比分析
   - 支持区域地图可视化展示

### 3.3 设备类型能耗占比分析
1. **数据统计**：
   - 统计选定时间范围内不同设备类型的能耗总量
   - 计算各设备类型的能耗占比

2. **数据展示**：
   - 以饼图或环形图形式展示设备类型能耗占比
   - 支持多级设备分类展示
   - 支持设备类型与区域的交叉分析

### 3.4 系统级能耗占比分析
1. **核心设备系统定义**：
   - 空调通风系统
   - 电梯扶梯系统
   - 安全票务系统
   - 照明系统
   - 给排水系统
   - 新能源系统

2. **数据统计**：
   - 按核心设备系统统计能耗总量
   - 计算各系统的能耗占比

3. **数据展示**：
   - 以环形图+表格组合展示系统级能耗占比
   - 支持按时间周期（日/周/月/年）切换
   - 自动标记占比超过20%的能耗系统

### 3.5 多级能耗拆解分析
1. **拆解层级**：
   - 第一级：全站能耗总量
   - 第二级：系统级能耗占比（核心设备系统）
   - 第三级：区域级能耗占比（各系统在不同区域的能耗）
   - 第四级：设备级能耗占比（各区域内具体设备的能耗）

2. **交互方式**：
   - 点击图表区域进行层级下钻
   - 使用导航树进行层级切换
   - 支持从任意层级返回上级或直接跳转到指定层级

3. **数据精度**：
   - 支持精确到单台设备的能耗占比分析
   - 确保各层级能耗数据的一致性和准确性

### 3.6 节能潜力分析
1. **自动标注**：
   - 针对占比超过阈值（默认20%）的能耗系统/区域/设备，自动标注为节能潜力区域
   - 使用醒目颜色和标识在图表上显示

2. **节能建议**：
   - 基于能耗占比分析结果，自动生成节能建议
   - 建议内容包括节能措施、预期效果和实施难度等

## 4. 数据流向

### 4.1 能耗占比分析数据流向
1. 用户选择统计时间范围和维度 → 前端发送查询请求 → 后端API处理 → 数据库查询统计 → 返回分析结果 → 前端展示能耗占比图表

### 4.2 多级能耗拆解数据流向
1. 用户点击图表区域进行下钻 → 前端发送层级查询请求 → 后端API处理 → 数据库查询对应层级的能耗数据 → 返回分析结果 → 前端展示下一层级的能耗占比图表

### 4.3 节能潜力分析数据流向
1. 能耗占比分析结果 → 节能潜力算法 → 识别高能耗系统/区域/设备 → 生成节能建议 → 前端展示标注和建议

## 5. 功能点击交互

### 5.1 能耗占比分析主页面
1. **页面布局**：
   - 顶部：时间范围选择器、统计维度选择器
   - 中部：能耗占比分析图表（饼图/环形图）
   - 下部：能耗占比数据表格、节能潜力标注

2. **交互流程**：
   - 选择时间范围和统计维度 → 图表自动更新
   - 点击图表区域 → 进行数据下钻，显示下一层级的能耗占比
   - 点击导航树上的节点 → 直接跳转到对应层级的能耗占比分析
   - 点击节能潜力标注 → 查看详细的节能建议

### 5.2 系统级能耗占比页面
1. **页面布局**：
   - 顶部：时间范围选择器、系统类型选择器
   - 中部：环形图展示系统级能耗占比
   - 下部：数据表格展示各系统的详细能耗数据

2. **交互流程**：
   - 选择时间范围 → 图表和表格自动更新
   - 点击环形图的某一系统 → 下钻查看该系统在不同区域的能耗占比
   - 点击数据表格中的系统名称 → 查看该系统的详细信息和能耗趋势

### 5.3 多级能耗拆解页面
1. **页面布局**：
   - 左侧：层级导航树（全站→系统→区域→设备）
   - 右侧：对应层级的能耗占比图表和数据

2. **交互流程**：
   - 点击导航树节点 → 右侧显示对应层级的能耗占比分析
   - 支持拖拽节点调整层级结构（仅管理员）
   - 提供面包屑导航，显示当前所在层级

## 6. 功能字段

### 6.1 能耗占比统计表
| 字段名称 | 数据类型 | 长度 | 约束条件 | 描述 |
|---------|---------|------|--------|------|
| ratio_id | 字符串 | 32 | 主键，唯一 | 占比记录ID |
| station_id | 字符串 | 32 | 非空 | 站点ID |
| start_time | 日期时间 | - | 非空 | 统计开始时间 |
| end_time | 日期时间 | - | 非空 | 统计结束时间 |
| energy_type | 字符串 | 20 | 可空 | 能源类型(电/水/燃气) |
| system_id | 字符串 | 32 | 可空 | 系统ID |
| region_id | 字符串 | 32 | 可空 | 区域ID |
| device_type_id | 字符串 | 32 | 可空 | 设备类型ID |
| energy_value | 数值 | - | 非空 | 能耗值 |
| energy_ratio | 数值 | - | 非空 | 能耗占比(百分比) |
| parent_ratio_id | 字符串 | 32 | 可空 | 父级占比记录ID |
| is_high_ratio | 布尔值 | - | 非空 | 是否高占比(>20%) |

### 6.2 系统级能耗占比表
| 字段名称 | 数据类型 | 长度 | 约束条件 | 描述 |
|---------|---------|------|--------|------|
| system_ratio_id | 字符串 | 32 | 主键，唯一 | 系统占比记录ID |
| station_id | 字符串 | 32 | 非空 | 站点ID |
| record_time | 日期时间 | - | 非空 | 记录时间 |
| system_type | 字符串 | 50 | 非空 | 系统类型 |
| energy_value | 数值 | - | 非空 | 能耗值 |
| energy_ratio | 数值 | - | 非空 | 能耗占比(百分比) |
| time_period | 字符串 | 10 | 非空 | 时间周期(日/周/月/年) |
| has_potential | 布尔值 | - | 非空 | 是否有节能潜力 |

### 6.3 节能建议表
| 字段名称 | 数据类型 | 长度 | 约束条件 | 描述 |
|---------|---------|------|--------|------|
| suggestion_id | 字符串 | 32 | 主键，唯一 | 建议ID |
| target_type | 字符串 | 20 | 非空 | 目标类型(系统/区域/设备) |
| target_id | 字符串 | 32 | 非空 | 目标ID |
| suggestion_content | 文本 | - | 非空 | 建议内容 |
| expected_effect | 文本 | - | 可空 | 预期效果 |
| difficulty_level | 字符串 | 10 | 非空 | 实施难度(低/中/高) |
| create_time | 日期时间 | - | 非空 | 创建时间 |

## 7. 异常情况及处理

### 7.1 数据异常
- **场景**：某些能源类型或系统的能耗数据缺失
- **处理**：
  - 在图表上显示为"数据缺失"
  - 提供数据补全建议
  - 不影响其他数据的正常展示

### 7.2 计算异常
- **场景**：能耗占比计算结果异常（如占比总和不等于100%）
- **处理**：
  - 系统自动检测计算异常
  - 显示计算误差提示
  - 提供重新计算功能

### 7.3 下钻异常
- **场景**：下钻到某一层级时无数据
- **处理**：
  - 显示"该层级无数据"提示
  - 自动返回上一层级
  - 建议用户调整查询条件

### 7.4 性能异常
- **场景**：大数据量下钻导致页面加载缓慢
- **处理**：
  - 显示加载状态和进度
  - 对大数据量进行采样处理
  - 提供数据分页功能

## 8. 性能要求

### 8.1 响应时间
- 能耗占比图表加载时间：≤3秒
- 多级能耗拆解响应时间：≤2秒/层级
- 节能建议生成时间：≤1秒

### 8.2 并发处理
- 支持≥100个并发用户同时访问能耗占比分析功能
- 支持≥50个并发用户同时进行多级能耗拆解

### 8.3 数据容量
- 支持存储≥5年的能耗占比分析结果
- 支持管理≥10,000台设备的能耗占比数据

### 8.4 数据精度
- 能耗占比计算精度：保留两位小数
- 多级能耗拆解数据一致性：确保各层级数据总和一致

## 9. 安全要求

### 9.1 访问控制
- 基于角色的访问控制（RBAC）
- 能耗占比分析功能对所有授权用户开放
- 节能建议管理功能仅对管理员开放

### 9.2 数据保护
- 能耗占比数据传输采用加密方式
- 能耗数据定期备份
- 严格的数据库访问权限控制

### 9.3 审计日志
- 记录所有能耗占比分析操作
- 记录操作人、操作时间、操作内容

## 10. 测试点

### 10.1 功能测试
- 能源类型能耗占比分析测试
- 区域能耗占比分析测试
- 设备类型能耗占比分析测试
- 系统级能耗占比分析测试
- 多级能耗拆解功能测试
- 节能潜力标注和建议测试

### 10.2 异常测试
- 数据缺失测试
- 计算异常测试
- 下钻异常测试
- 性能异常测试

### 10.3 性能测试
- 能耗占比图表加载性能测试
- 多级能耗拆解响应性能测试
- 并发用户访问测试

## 11. 依赖关系

### 11.1 内部依赖
- 数据采集模块（能耗数据来源）
- 设备与系统管理模块（设备和系统信息）

### 11.2 外部依赖
- 数据库系统
- 图表库（数据可视化）
- 数据分析算法库

## 12. 变更记录

| 版本 | 变更日期 | 变更内容 | 变更人 | 审核人 |
|------|---------|---------|-------|-------|
| V1.0 | 2025-12-23 | 能耗占比分析模块设计文档初稿 | 系统设计师 | |
