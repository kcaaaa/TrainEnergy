# 能耗报告生成模块设计文档

## 1. 功能概述
能耗报告生成模块用于自动生成高铁站能耗相关的各类报告，支持多种报告类型和定制化内容。该模块能够根据用户需求生成日、周、月、季、年度能耗报告，以及专项分析报告（如节能效果评估报告、异常能耗分析报告）。报告内容包含能耗数据汇总、趋势分析、异常预警、节能效果评估等，支持多种导出格式（PDF、Excel、Word），并提供报告历史管理功能。

## 2. 输入/输出示例
### 2.1 输入
| 输入项 | 描述 | 数据类型 | 约束条件 |
|--------|------|----------|----------|
| 报告类型 | 报告的类型（日报/周报/月报/季报/年报/专项报告） | 单选 | 必选 |
| 报告时间范围 | 报告的时间周期 | 日期区间/预设周期 | 必选 |
| 报告内容选择 | 报告包含的内容模块（数据汇总/趋势分析/异常预警等） | 多选 | 至少选择1项 |
| 报告格式 | 报告的导出格式（PDF/Excel/Word） | 单选 | 必选 |
| 应用站点/区域 | 报告覆盖的站点或区域 | 多选 | 必选 |
| 报告接收人 | 报告的接收人（用于邮件发送） | 多选 | 可选 |
| 定制化参数 | 报告的定制化设置（如图表类型、数据维度、排序方式） | JSON | 可选 |

### 2.2 输出
| 输出项 | 描述 | 数据类型 | 展示形式 |
|--------|------|----------|----------|
| 报告预览 | 报告生成前的预览内容 | HTML | 网页预览 |
| 生成报告 | 最终生成的报告文件 | 文件 | PDF/Excel/Word |
| 报告下载链接 | 报告的下载地址 | URL | 链接 |
| 报告发送状态 | 报告邮件发送的状态 | 文本 | 发送成功/发送失败/待发送 |
| 报告历史记录 | 已生成报告的历史列表 | 列表 | 可筛选、可搜索 |

## 3. 功能逻辑详细描述

### 3.1 报告类型管理

#### 3.1.1 预设报告类型
1. 系统支持以下预设报告类型：
   - 日报：每日能耗数据汇总和简要分析
   - 周报：每周能耗趋势和关键指标分析
   - 月报：月度能耗统计、趋势分析和异常预警
   - 季报：季度能耗总结、节能效果评估和趋势预测
   - 年报：年度能耗综合分析、节能成果展示和年度计划建议

2. 每种报告类型包含默认的报告内容和格式设置

#### 3.1.2 专项报告
1. 系统提供多种专项报告模板：
   - 节能效果评估报告：评估特定节能措施的实施效果
   - 异常能耗分析报告：分析能耗异常的原因和影响
   - 能耗对比分析报告：对比不同站点或时间段的能耗数据
   - 设备能耗分析报告：分析特定设备或系统的能耗情况

2. 专项报告支持自定义报告内容和参数

### 3.2 报告内容定制

#### 3.2.1 内容模块选择
1. 报告内容由多个模块组成，用户可自由选择：
   - 数据汇总模块：能耗总量、人均能耗、单位面积能耗等关键指标
   - 趋势分析模块：能耗变化趋势图表（折线图、柱状图）
   - 异常预警模块：能耗异常事件列表和分析
   - 节能效果模块：节能措施实施前后的能耗对比和效果评估
   - 能耗占比模块：不同能源类型、系统或区域的能耗占比
   - 预测分析模块：基于历史数据的能耗预测
   - 建议与计划模块：节能建议和下一步工作计划

2. 支持模块的添加、删除和排序

#### 3.2.2 数据维度选择
1. 支持从多个维度选择报告数据：
   - 时间维度：小时、日、周、月、季、年
   - 空间维度：站点、区域、楼层、房间
   - 系统维度：照明、空调、通风、动力等
   - 能源类型维度：电、水、气、热力等

2. 支持多维度组合分析

### 3.3 报告生成与导出

#### 3.3.1 报告生成流程
1. 用户选择报告类型和时间范围
2. 选择报告内容模块和数据维度
3. 进行报告预览
4. 确认生成报告
5. 系统后台生成报告文件
6. 报告生成完成后通知用户

#### 3.3.2 导出格式支持
1. PDF格式：适合正式报告和打印
2. Excel格式：适合数据进一步分析和编辑
3. Word格式：适合灵活编辑和格式调整

2. 每种格式提供相应的模板和样式设置

#### 3.3.3 批量生成报告
1. 支持同时生成多个报告（如多个站点的月报）
2. 支持设置报告生成计划（如每月1日自动生成上月报告）

### 3.4 报告发送与分享

#### 3.4.1 邮件发送
1. 支持将生成的报告通过邮件发送给指定接收人
2. 可预设邮件模板和发送计划
3. 记录邮件发送状态和日志

#### 3.4.2 报告分享
1. 支持生成报告的分享链接
2. 可设置链接的有效期和访问权限
3. 支持通过二维码分享报告

### 3.5 报告历史管理

#### 3.5.1 报告存储
1. 系统自动存储所有生成的报告
2. 支持按报告类型、时间、站点等条件分类存储

#### 3.5.2 报告检索
1. 支持多种检索条件：报告类型、时间范围、站点、报告名称等
2. 支持模糊搜索和高级筛选

#### 3.5.3 报告操作
1. 查看报告详情
2. 下载报告
3. 重新生成报告
4. 删除报告（支持批量删除）
5. 查看报告生成日志

### 3.6 报告模板管理

#### 3.6.1 模板创建与编辑
1. 支持创建自定义报告模板
2. 可编辑模板的内容模块、格式、样式等
3. 支持模板的导入和导出

#### 3.6.2 模板权限管理
1. 可设置模板的访问权限（公开/私有）
2. 支持模板的共享和复制

## 4. 数据流向图

```
[用户选择报告类型和时间范围] → [选择报告内容模块和数据维度] → [生成报告预览] → [用户确认生成] → [系统获取原始能耗数据] → [数据处理与分析] → [应用报告模板] → [生成报告文件] → [存储报告到历史记录] → [通知用户报告生成完成] → [提供报告下载/发送功能]
```

## 5. 功能点击交互流程

1. **进入报告生成页面**
   - 用户从导航菜单点击"能耗报告生成"选项
   - 页面加载报告类型选择界面

2. **选择报告类型和时间范围**
   - 在报告类型下拉菜单中选择报告类型
   - 根据选择的报告类型，时间范围选择器自动调整
   - 点击时间范围选择器，选择报告的时间周期

3. **选择报告内容和数据维度**
   - 在内容模块列表中选择报告包含的模块
   - 调整模块的顺序
   - 选择报告的数据维度（站点、区域、能源类型等）

4. **设置报告格式和参数**
   - 在报告格式下拉菜单中选择导出格式（PDF/Excel/Word）
   - 点击"高级设置"可进行定制化参数设置
   - 设置报告接收人和发送方式（可选）

5. **预览报告**
   - 点击"预览报告"按钮
   - 系统生成报告预览内容
   - 用户查看预览，确认报告内容和格式

6. **生成报告**
   - 确认预览无误后，点击"生成报告"按钮
   - 页面显示报告生成进度
   - 系统后台进行数据处理和报告生成

7. **查看报告生成结果**
   - 报告生成完成后，页面显示下载链接
   - 如设置了邮件发送，显示发送状态
   - 可点击"查看历史报告"进入报告历史管理页面

8. **管理历史报告**
   - 在报告历史页面，可通过搜索和筛选查找特定报告
   - 点击报告名称可查看报告详情
   - 可进行下载、重新生成、删除等操作

## 6. 功能字段详细说明

| 字段名称 | 字段类型 | 长度 | 是否必填 | 约束条件 | 描述 |
|----------|----------|------|----------|----------|------|
| 报告ID | String | 32 | 是 | 唯一标识符 | 报告的唯一标识 |
| 报告名称 | String | 200 | 是 | - | 报告的名称 |
| 报告类型 | String | 50 | 是 | 日报/周报/月报/季报/年报/专项报告 | 报告的类型 |
| 时间范围 | JSON | - | 是 | - | 报告的时间周期（开始时间和结束时间） |
| 内容模块 | JSON | - | 是 | - | 报告包含的内容模块列表 |
| 数据维度 | JSON | - | 是 | - | 报告的数据维度设置 |
| 报告格式 | String | 20 | 是 | PDF/Excel/Word | 报告的导出格式 |
| 应用范围 | JSON | - | 是 | - | 报告覆盖的站点和区域 |
| 接收人 | JSON | - | 否 | - | 报告的接收人列表 |
| 生成状态 | String | 20 | 是 | 生成中/已完成/生成失败/待生成 | 报告的生成状态 |
| 生成时间 | DateTime | - | 是 | - | 报告生成的时间 |
| 生成人 | String | 50 | 是 | - | 报告生成人 |
| 文件路径 | String | 500 | 是 | - | 报告文件的存储路径 |
| 文件大小 | Long | - | 是 | - | 报告文件的大小（字节） |
| 下载次数 | Integer | - | 是 | ≥0 | 报告的下载次数 |
| 发送状态 | String | 20 | 否 | 发送成功/发送失败/待发送 | 报告邮件发送状态 |

## 7. 异常情况处理

| 异常场景 | 异常描述 | 处理方式 | 系统反馈 |
|----------|----------|----------|----------|
| 未选择报告类型 | 用户未选择报告类型 | 前端校验 | 提示"请选择报告类型" |
| 未选择时间范围 | 用户未选择报告的时间范围 | 前端校验 | 提示"请选择报告的时间范围" |
| 未选择报告内容 | 用户未选择报告内容模块 | 前端校验 | 提示"请至少选择1个报告内容模块" |
| 数据获取失败 | 系统无法获取报告所需的原始数据 | 错误处理 | 提示"数据获取失败，请稍后重试" |
| 报告生成失败 | 报告生成过程中出现错误 | 错误处理 | 提示"报告生成失败，请检查参数设置或稍后重试" |
| 报告预览失败 | 报告预览生成失败 | 错误处理 | 提示"报告预览失败，请检查参数设置" |
| 文件存储失败 | 报告文件存储失败 | 错误处理 | 提示"文件存储失败，请稍后重试" |
| 邮件发送失败 | 报告邮件发送失败 | 错误处理 | 提示"邮件发送失败，请检查接收人邮箱或稍后重试" |
| 下载链接过期 | 报告下载链接已过期 | 错误处理 | 提示"下载链接已过期，请重新生成报告" |
| 权限不足 | 用户没有访问或生成报告的权限 | 权限校验 | 提示"您没有权限执行此操作" |

## 8. 性能要求

| 性能指标 | 要求 | 说明 |
|----------|------|------|
| 页面加载时间 | ≤3秒 | 页面初始化加载完成时间 |
| 报告预览生成时间 | ≤5秒 | 从请求预览到预览内容显示的时间 |
| 报告生成时间 | ≤30秒 | 从开始生成到报告完成的时间 |
| 支持并发生成报告数 | 10个 | 系统同时支持生成的报告数量 |
| 单个报告最大数据量 | 100万条 | 单份报告可处理的最大数据量 |
| 报告历史存储量 | 10万份 | 系统可存储的历史报告数量 |
| 并发用户数 | 1000 | 系统支持的并发用户数量 |

## 9. 安全要求

| 安全项 | 要求 | 说明 |
|--------|------|------|
| 权限控制 | 基于角色的访问控制 | 不同角色拥有不同的报告操作权限 |
| 数据加密 | 存储加密 | 报告文件存储时进行加密 |
| 传输加密 | HTTPS传输 | 报告下载和邮件发送过程中采用HTTPS加密 |
| 访问控制 | 下载链接权限 | 报告下载链接设置有效期和访问权限 |
| 操作日志 | 记录用户操作 | 记录报告生成、下载、删除等操作日志 |
| 敏感数据保护 | 数据脱敏 | 报告中涉及敏感信息的数据进行脱敏处理 |
| 报告隔离 | 用户间报告隔离 | 不同用户的报告相互隔离，防止未授权访问 |

## 10. 测试点

| 测试项 | 测试内容 | 期望结果 |
|--------|----------|----------|
| 报告类型选择 | 验证不同报告类型的选择和时间范围自适应 | 时间范围选择器根据报告类型正确调整 |
| 报告内容定制 | 验证内容模块的选择、排序和参数设置 | 能正确选择和排序内容模块，参数设置有效 |
| 报告预览功能 | 验证报告预览的生成和显示 | 预览内容准确反映报告设置，显示正常 |
| 报告生成功能 | 验证不同格式报告的生成 | 能成功生成PDF/Excel/Word格式的报告 |
| 批量生成功能 | 验证批量生成多个报告的功能 | 能同时生成多个报告，且状态正确 |
| 邮件发送功能 | 验证报告邮件发送功能 | 报告能成功发送到指定接收人邮箱 |
| 报告历史管理 | 验证报告历史的存储、检索和操作 | 报告历史记录完整，检索准确，操作有效 |
| 报告模板管理 | 验证自定义报告模板的创建和应用 | 能成功创建和应用自定义模板 |
| 异常情况处理 | 验证各种异常场景的处理 | 异常提示准确，系统处理合理 |
| 性能测试 | 验证页面加载、报告生成等性能指标 | 满足性能要求 |
| 安全测试 | 验证权限控制、数据加密等安全措施 | 安全措施有效 |

## 11. 依赖关系

| 依赖项 | 描述 | 依赖类型 |
|--------|------|----------|
| 能耗历史数据 | 报告生成所需的历史能耗数据 | 数据依赖 |
| 站点基础信息 | 报告中的站点和区域信息 | 数据依赖 |
| 异常预警数据 | 报告中的异常能耗事件数据 | 数据依赖 |
| 节能策略数据 | 报告中的节能措施和效果数据 | 数据依赖 |
| 文件存储服务 | 报告文件的存储服务 | 服务依赖 |
| 邮件发送服务 | 报告邮件发送服务 | 服务依赖 |
| 模板引擎 | 报告内容的模板渲染 | 服务依赖 |

## 12. 功能变更记录

| 版本号 | 变更日期 | 变更内容 | 变更人 | 审核人 |
|--------|----------|----------|--------|--------|
| V1.0 | 2023-11-15 | 初始版本 | 张工 | 李工 |
| V1.1 | 2023-11-25 | 增加专项报告类型和自定义模板功能 | 王工 | 赵工 |
| V1.2 | 2023-12-05 | 优化报告生成性能和导出格式 | 刘工 | 陈工 |

## 13. 附加说明

1. 支持报告的定时自动生成和发送，可设置生成周期和发送时间
2. 提供报告内容的自定义样式设置，如颜色、字体、图表类型等
3. 支持报告数据的钻取功能，点击图表或数据可查看更详细的信息
4. 提供报告生成的进度提示和预计完成时间
5. 支持报告的批量导出和删除操作
6. 报告历史记录支持按时间、站点、类型等条件进行筛选和排序