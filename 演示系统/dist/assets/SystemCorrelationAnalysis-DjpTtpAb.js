import{A as e,C as t,D as n,E as r,M as i,O as a,S as o,T as s,_ as c,b as l,c as u,d,g as f,h as p,k as m,m as h,p as g,r as _,t as v,u as y,w as b,x,y as S}from"./index-DexfLrHx.js";var C={name:`SystemCorrelationAnalysis`,setup(){let e=m(!1),t=m(!1),n=m(`overlay`),r=m(null),i=m(null),o=m(null),u=null,d=null,f=null,p=a({systems:[`SYS001`,`SYS002`,`SYS003`],dateRange:[]}),h=m([{id:`SYS001`,name:`照明系统`},{id:`SYS002`,name:`空调系统`},{id:`SYS003`,name:`通风系统`},{id:`SYS004`,name:`给排水系统`},{id:`SYS005`,name:`电梯系统`},{id:`SYS006`,name:`安防系统`}]),g=m([]),_=m([]),y=e=>{let t=[],n={strong:[`存在强正向联动关系`,`能耗模式高度同步`,`建议协调调度`],moderate:[`存在中度关联`,`部分时段联动明显`,`关注能耗峰值`],weak:[`关联性较弱`,`相对独立运行`,`可优化控制策略`],negative:[`存在负相关关系`,`呈现互补能耗模式`,`可用于负荷平衡`]};for(let r=0;r<e.length;r++)for(let i=r+1;i<e.length;i++){let a=Math.random()*2-.5,o,s;a>.7?(o=`强相关`,s=0):a>.4?(o=`中等相关`,s=1):a>.2?(o=`弱相关`,s=2):a>-.2?(o=`几乎无关`,s=2):(o=`负相关`,s=3),t.push({id:`${e[r]}-${e[i]}`,system1:h.value.find(t=>t.id===e[r])?.name||e[r],system2:h.value.find(t=>t.id===e[i])?.name||e[i],coefficient:a,strength:o,lag:Math.floor(Math.random()*4),description:n[s][Math.floor(Math.random()*3)]})}return t.sort((e,t)=>Math.abs(t.coefficient)-Math.abs(e.coefficient))},b=e=>{let t=[],n=e.filter(e=>e.coefficient>.7),r=e.filter(e=>e.coefficient<-.3),i=e.filter(e=>Math.abs(e.coefficient)<.2);return n.length>0&&t.push({type:`warning`,icon:`fa fa-exclamation-circle`,title:`强联动系统组`,description:`${n.length}组系统存在强正向关联，建议协调运行策略以优化整体能耗`,impact:`高`,impactType:`danger`}),r.length>0&&t.push({type:`success`,icon:`fa fa-check-circle`,title:`负荷互补优化`,description:`${r.length}组系统呈现负相关，可利用互补特性进行负荷平衡`,impact:`中`,impactType:`warning`}),i.length>0&&t.push({type:`info`,icon:`fa fa-info-circle`,title:`独立运行系统`,description:`${i.length}组系统关联性较弱，可考虑独立优化控制策略`,impact:`低`,impactType:`info`}),t.push({type:`success`,icon:`fa fa-lightbulb-o`,title:`优化建议`,description:`空调与通风系统存在较强关联，建议采用联动控制策略，预计可降低综合能耗5-10%`,impact:`高`,impactType:`success`}),t},x=()=>{r.value&&(u=v(r.value),w()),i.value&&(d=v(i.value),T()),o.value&&(f=v(o.value),E()),window.addEventListener(`resize`,C)},C=()=>{u&&u.resize(),d&&d.resize(),f&&f.resize()},w=()=>{let e=p.systems.map(e=>{let t=h.value.find(t=>t.id===e);return t?t.name:e}),t=[];for(let n=0;n<e.length;n++)for(let r=0;r<e.length;r++)if(n===r)t.push([n,r,1]);else{let i=g.value.find(t=>t.system1===e[n]&&t.system2===e[r]||t.system1===e[r]&&t.system2===e[n])?.coefficient||Math.random()*.6+.2;t.push([n,r,i])}let n={tooltip:{position:`top`,formatter:t=>t.value[0]===t.value[1]?`自身`:`${e[t.value[0]]} - ${e[t.value[1]]}<br/>相关系数: ${t.value[2].toFixed(3)}`},grid:{left:`15%`,right:`15%`,top:`10%`,bottom:`15%`},xAxis:{type:`category`,data:e,splitArea:{show:!0}},yAxis:{type:`category`,data:e,splitArea:{show:!0}},visualMap:{min:-.5,max:1,calculable:!0,orient:`horizontal`,left:`center`,bottom:`0%`,inRange:{color:[`#f5222d`,`#faad14`,`#f0f0f0`,`#52c41a`,`#389e0d`]}},series:[{type:`heatmap`,data:t,label:{show:e.length<=4},emphasis:{itemStyle:{shadowBlur:10,shadowColor:`rgba(0, 0, 0, 0.5)`}}}]};u.setOption(n)},T=()=>{let e=[];for(let t=0;t<30;t++){let n=new Date;n.setDate(n.getDate()-29+t),e.push(n.toISOString().split(`T`)[0])}let t=p.systems.map((t,r)=>{let i=h.value.find(e=>e.id===t),a=100+r*50;return{name:i?.name||t,type:`line`,data:e.map(()=>a+Math.random()*100),smooth:!0,emphasis:{focus:`series`},yAxisIndex:n.value===`separate`?r:0}}),r={tooltip:{trigger:`axis`,axisPointer:{type:`cross`}},legend:{data:p.systems.map(e=>h.value.find(t=>t.id===e)?.name),bottom:0},grid:{left:`3%`,right:`4%`,bottom:`15%`,top:`10%`,containLabel:!0},xAxis:{type:`category`,boundaryGap:!1,data:e},yAxis:n.value===`separate`?p.systems.map((e,t)=>({type:`value`,name:h.value.find(e=>e.id===p.systems[t])?.name,position:t%2==0?`left`:`right`})):{type:`value`,name:`能耗 (kWh)`},series:t};d.setOption(r,!0)},E=()=>{g.value.filter(e=>e.coefficient>0).length;let e=g.value.filter(e=>e.coefficient<0).length,t=g.value.filter(e=>Math.abs(e.coefficient)>.6).length,n=g.value.filter(e=>Math.abs(e.coefficient)>.3&&Math.abs(e.coefficient)<=.6).length,r=g.value.filter(e=>Math.abs(e.coefficient)<=.3).length,i={tooltip:{trigger:`item`,formatter:`{b}: {c}组 ({d}%)`},legend:{orient:`vertical`,right:`5%`,top:`center`},series:[{type:`pie`,radius:[`40%`,`70%`],center:[`35%`,`50%`],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:`#fff`,borderWidth:2},label:{show:!1},emphasis:{label:{show:!0,fontSize:16,fontWeight:`bold`}},data:[{value:t,name:`强相关`,itemStyle:{color:`#389e0d`}},{value:n,name:`中等相关`,itemStyle:{color:`#1890ff`}},{value:r,name:`弱相关`,itemStyle:{color:`#faad14`}},{value:e,name:`负相关`,itemStyle:{color:`#f5222d`}}]}]};f.setOption(i)},D=()=>{p.systems.length<2||(e.value=!0,t.value=!1,setTimeout(()=>{g.value=y(p.systems),_.value=b(g.value),e.value=!1,t.value=!0,c(()=>{x()})},800))};return s(n,()=>{c(()=>{T()})}),S(()=>{D()}),l(()=>{window.removeEventListener(`resize`,C),u&&u.dispose(),d&&d.dispose(),f&&f.dispose()}),{loading:e,analysisComplete:t,trendView:n,filterForm:p,systemList:h,correlationData:g,keyFindings:_,heatmapRef:r,trendChartRef:i,distributionRef:o,handleAnalyze:D,handleReset:()=>{p.systems=[`SYS001`,`SYS002`,`SYS003`],p.dateRange=[],t.value=!1},handleExportData:()=>{let e=[[`系统1`,`系统2`,`相关系数`,`关联强度`,`时间滞后(小时)`,`关联描述`],...g.value.map(e=>[e.system1,e.system2,e.coefficient.toFixed(3),e.strength,e.lag,e.description])].map(e=>e.join(`,`)).join(`
`),t=new Blob([e],{type:`text/csv;charset=utf-8;`}),n=document.createElement(`a`);n.href=URL.createObjectURL(t),n.download=`系统关联分析_${new Date().toISOString().split(`T`)[0]}.csv`,n.click()},handleGenerateReport:()=>{console.log(`Generating report...`)},getCoefficientType:e=>e>.7?`success`:e>.4?``:e>.2||e>-.2?`info`:`warning`,getStrengthType:e=>e===`强相关`?`success`:e===`中等相关`?``:e===`负相关`?`warning`:`info`}}},w={class:`system-correlation-analysis`},T={class:`filter-section`},E={key:0,class:`analysis-results`},D={class:`card-header`},O={ref:`heatmapRef`,class:`chart-container`},k={class:`card-header`},A={ref:`trendChartRef`,class:`chart-container`},j={ref:`distributionRef`,class:`chart-container`},M={class:`card-header`},N={class:`findings-list`},P={class:`finding-content`},F={class:`finding-title`},I={class:`finding-desc`},L={class:`finding-impact`},R={class:`card-header`},z={key:1,class:`empty-state`};function B(a,s,c,l,m,_){let v=t(`el-option`),S=t(`el-select`),C=t(`el-form-item`),B=t(`el-date-picker`),V=t(`el-button`),H=t(`el-form`),U=t(`el-tag`),W=t(`el-card`),G=t(`el-col`),K=t(`el-radio-button`),q=t(`el-radio-group`),J=t(`el-row`),Y=t(`el-table-column`),X=t(`el-table`),Z=b(`loading`);return x(),g(`div`,w,[y(`div`,T,[f(H,{inline:!0,model:l.filterForm,class:`filter-form`},{default:r(()=>[f(C,{label:`分析系统`},{default:r(()=>[f(S,{modelValue:l.filterForm.systems,"onUpdate:modelValue":s[0]||=e=>l.filterForm.systems=e,multiple:``,placeholder:`选择参与分析的系统`,"collapse-tags":``,"collapse-tags-tooltip":``},{default:r(()=>[(x(!0),g(u,null,o(l.systemList,e=>(x(),d(v,{key:e.id,label:e.name,value:e.id},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),f(C,{label:`时间范围`},{default:r(()=>[f(B,{modelValue:l.filterForm.dateRange,"onUpdate:modelValue":s[1]||=e=>l.filterForm.dateRange=e,type:`daterange`,"range-separator":`至`,"start-placeholder":`开始日期`,"end-placeholder":`结束日期`,"value-format":`YYYY-MM-DD`},null,8,[`modelValue`])]),_:1}),f(C,null,{default:r(()=>[f(V,{type:`primary`,onClick:l.handleAnalyze},{default:r(()=>[...s[3]||=[y(`i`,{class:`fa fa-search`},null,-1),p(` 分析关联 `,-1)]]),_:1},8,[`onClick`]),f(V,{onClick:l.handleReset},{default:r(()=>[...s[4]||=[y(`i`,{class:`fa fa-refresh`},null,-1),p(` 重置 `,-1)]]),_:1},8,[`onClick`])]),_:1})]),_:1},8,[`model`])]),l.analysisComplete?(x(),g(`div`,E,[f(J,{gutter:20},{default:r(()=>[f(G,{span:12},{default:r(()=>[f(W,{shadow:`hover`},{header:r(()=>[y(`div`,D,[s[6]||=y(`span`,null,`相关性热力图`,-1),f(U,{type:`info`},{default:r(()=>[...s[5]||=[p(`Pearson相关系数`,-1)]]),_:1})])]),default:r(()=>[y(`div`,O,null,512)]),_:1})]),_:1}),f(G,{span:12},{default:r(()=>[f(W,{shadow:`hover`},{header:r(()=>[y(`div`,k,[s[9]||=y(`span`,null,`能耗联动趋势`,-1),f(q,{modelValue:l.trendView,"onUpdate:modelValue":s[2]||=e=>l.trendView=e,size:`small`},{default:r(()=>[f(K,{label:`overlay`},{default:r(()=>[...s[7]||=[p(`叠加`,-1)]]),_:1}),f(K,{label:`separate`},{default:r(()=>[...s[8]||=[p(`分离`,-1)]]),_:1})]),_:1},8,[`modelValue`])])]),default:r(()=>[y(`div`,A,null,512)]),_:1})]),_:1})]),_:1}),f(J,{gutter:20,style:{"margin-top":`20px`}},{default:r(()=>[f(G,{span:12},{default:r(()=>[f(W,{shadow:`hover`},{header:r(()=>[...s[10]||=[y(`span`,null,`关联强度分布`,-1)]]),default:r(()=>[y(`div`,j,null,512)]),_:1})]),_:1}),f(G,{span:12},{default:r(()=>[f(W,{shadow:`hover`},{header:r(()=>[y(`div`,M,[s[12]||=y(`span`,null,`关键发现`,-1),f(V,{type:`text`,size:`small`,onClick:l.handleGenerateReport},{default:r(()=>[...s[11]||=[y(`i`,{class:`fa fa-file-text-o`},null,-1),p(` 生成报告 `,-1)]]),_:1},8,[`onClick`])])]),default:r(()=>[y(`div`,N,[(x(!0),g(u,null,o(l.keyFindings,(t,n)=>(x(),g(`div`,{key:n,class:`finding-item`},[y(`div`,{class:e([`finding-icon`,t.type])},[y(`i`,{class:e(t.icon)},null,2)],2),y(`div`,P,[y(`div`,F,i(t.title),1),y(`div`,I,i(t.description),1),y(`div`,L,[f(U,{type:t.impactType,size:`small`},{default:r(()=>[p(`影响度: `+i(t.impact),1)]),_:2},1032,[`type`])])])]))),128))])]),_:1})]),_:1})]),_:1}),f(W,{shadow:`hover`,style:{"margin-top":`20px`}},{header:r(()=>[y(`div`,R,[s[14]||=y(`span`,null,`详细相关性数据`,-1),f(V,{type:`primary`,size:`small`,onClick:l.handleExportData},{default:r(()=>[...s[13]||=[y(`i`,{class:`fa fa-download`},null,-1),p(` 导出数据 `,-1)]]),_:1},8,[`onClick`])])]),default:r(()=>[n((x(),d(X,{data:l.correlationData,stripe:``},{default:r(()=>[f(Y,{prop:`system1`,label:`系统1`,width:`150`}),f(Y,{prop:`system2`,label:`系统2`,width:`150`}),f(Y,{prop:`coefficient`,label:`相关系数`,width:`120`,align:`center`},{default:r(e=>[f(U,{type:l.getCoefficientType(e.row.coefficient)},{default:r(()=>[p(i(e.row.coefficient.toFixed(3)),1)]),_:2},1032,[`type`])]),_:1}),f(Y,{prop:`strength`,label:`关联强度`,width:`120`,align:`center`},{default:r(e=>[f(U,{type:l.getStrengthType(e.row.strength)},{default:r(()=>[p(i(e.row.strength),1)]),_:2},1032,[`type`])]),_:1}),f(Y,{prop:`lag`,label:`时间滞后`,width:`100`,align:`center`},{default:r(e=>[y(`span`,null,i(e.row.lag)+`小时`,1)]),_:1}),f(Y,{prop:`description`,label:`关联描述`,"min-width":`250`})]),_:1},8,[`data`])),[[Z,l.loading]])]),_:1})])):(x(),g(`div`,z,[...s[15]||=[h(`<div class="empty-content" data-v-c827f954><i class="fa fa-connectdevelop" data-v-c827f954></i><h3 data-v-c827f954>系统关联分析</h3><p data-v-c827f954>请选择参与分析的系统，时间范围后点击&quot;分析关联&quot;按钮开始分析</p><div class="analysis-tips" data-v-c827f954><div class="tip-item" data-v-c827f954><i class="fa fa-lightbulb-o" data-v-c827f954></i><span data-v-c827f954>支持多系统相关性分析</span></div><div class="tip-item" data-v-c827f954><i class="fa fa-clock-o" data-v-c827f954></i><span data-v-c827f954>识别能耗联动模式</span></div><div class="tip-item" data-v-c827f954><i class="fa fa-exclamation-triangle" data-v-c827f954></i><span data-v-c827f954>发现异常关联行为</span></div></div></div>`,1)]]))])}var V=_(C,[[`render`,B],[`__scopeId`,`data-v-c827f954`]]);export{V as default};