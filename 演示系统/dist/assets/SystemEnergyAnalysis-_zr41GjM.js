import{C as e,D as t,E as n,M as r,O as i,S as a,T as o,_ as s,b as c,c as l,d as u,g as d,h as f,k as p,p as m,r as h,t as g,u as _,w as v,x as y,y as b}from"./index-DexfLrHx.js";var x={name:`SystemEnergyAnalysis`,setup(){let e=p(!1),t=p(`line`),n=p(null),r=p(null),a=null,l=p(!1),u=i({systemId:``,dateRange:[],granularity:`day`}),d=p([{id:`SYS001`,name:`照明系统`},{id:`SYS002`,name:`空调系统`},{id:`SYS003`,name:`通风系统`},{id:`SYS004`,name:`给排水系统`},{id:`SYS005`,name:`电梯系统`},{id:`SYS006`,name:`安防系统`}]),f=i({totalConsumption:125680.5,avgDailyConsumption:4196.02,peakValue:8562.3,avgLoadRate:68}),m=p([]),h=i({currentPage:1,pageSize:10,total:0}),_=()=>{let e=[],t=[`照明系统`,`空调系统`,`通风系统`,`给排水系统`,`电梯系统`,`安防系统`],n=new Date(`2024-01-01`);for(let r=0;r<30;r++){let i=new Date(n);i.setDate(n.getDate()+r);let a=i.toISOString().split(`T`)[0];t.forEach(t=>{e.push({id:`${a}-${t}`,date:a,systemName:t,consumption:Math.random()*500+100,peakPower:Math.random()*200+50,avgPower:Math.random()*100+30,loadRate:Math.floor(Math.random()*40+50),cost:Math.random()*500+100})})}return e},v=()=>{n.value&&(a=g(n.value),x()),r.value&&(l=g(r.value),S()),window.addEventListener(`resize`,y)},y=()=>{a&&a.resize(),l&&l.resize()},x=()=>{let e=m.value.slice(0,30).map(e=>e.date).filter((e,t,n)=>n.indexOf(e)===t),n=d.value.map(n=>({name:n.name,type:t.value,data:e.map(e=>{let t=m.value.filter(t=>t.date===e&&t.systemName===n.name);return t.length>0?t[0].consumption:0}),smooth:!0,emphasis:{focus:`series`}})),r={tooltip:{trigger:`axis`,axisPointer:{type:`cross`}},legend:{data:d.value.map(e=>e.name),bottom:0},grid:{left:`3%`,right:`4%`,bottom:`15%`,top:`10%`,containLabel:!0},xAxis:{type:`category`,boundaryGap:t.value===`bar`,data:e},yAxis:{type:`value`,name:`能耗 (kWh)`,axisLabel:{formatter:`{value}`}},series:n};a.setOption(r)},S=()=>{let e={tooltip:{trigger:`item`,formatter:`{b}: {c} kWh ({d}%)`},legend:{orient:`vertical`,right:`5%`,top:`center`},series:[{type:`pie`,radius:[`40%`,`70%`],center:[`35%`,`50%`],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:`#fff`,borderWidth:2},label:{show:!1,position:`center`},emphasis:{label:{show:!0,fontSize:16,fontWeight:`bold`}},labelLine:{show:!1},data:d.value.map(e=>{let t=m.value.filter(t=>t.systemName===e.name).reduce((e,t)=>e+t.consumption,0);return{name:e.name,value:t}})}]};l.setOption(e)},C=()=>{e.value=!0,setTimeout(()=>{m.value=_(),h.total=m.value.length,e.value=!1,s(()=>{x(),S()})},500)};return o(t,()=>{s(()=>{x()})}),b(()=>{C(),s(()=>{v()})}),c(()=>{window.removeEventListener(`resize`,y),a&&a.dispose(),l&&l.dispose()}),{loading:e,chartType:t,trendChartRef:n,pieChartRef:r,filterForm:u,systemList:d,stats:f,energyData:m,pagination:h,handleQuery:C,handleReset:()=>{u.systemId=``,u.dateRange=[],u.granularity=`day`,C()},handleExport:()=>{let e=[[`日期`,`系统名称`,`能耗 (kWh)`,`峰值功率 (kW)`,`平均功率 (kW)`,`负载率 (%)`,`预估费用 (元)`],...m.value.map(e=>[e.date,e.systemName,e.consumption.toFixed(2),e.peakPower.toFixed(2),e.avgPower.toFixed(2),e.loadRate,e.cost.toFixed(2)])].map(e=>e.join(`,`)).join(`
`),t=new Blob([e],{type:`text/csv;charset=utf-8;`}),n=document.createElement(`a`);n.href=URL.createObjectURL(t),n.download=`系统能耗分析_${new Date().toISOString().split(`T`)[0]}.csv`,n.click()},getLoadRateType:e=>e>=80?`success`:e>=60?`warning`:`danger`,handleSizeChange:()=>{C()},handleCurrentChange:()=>{C()}}}},S={class:`system-energy-analysis`},C={class:`filter-section`},w={class:`stats-cards`},T={class:`stat-content`},E={class:`stat-info`},D={class:`stat-value`},O={class:`stat-content`},k={class:`stat-info`},A={class:`stat-value`},j={class:`stat-content`},M={class:`stat-info`},N={class:`stat-value`},P={class:`stat-content`},F={class:`stat-info`},I={class:`stat-value`},L={class:`chart-section`},R={class:`card-header`},z={ref:`trendChartRef`,class:`chart-container`},B={ref:`pieChartRef`,class:`chart-container`},V={class:`table-section`},H={class:`card-header`},U={class:`pagination-section`};function W(i,o,s,c,p,h){let g=e(`el-option`),b=e(`el-select`),x=e(`el-form-item`),W=e(`el-date-picker`),G=e(`el-button`),K=e(`el-form`),q=e(`el-card`),J=e(`el-col`),Y=e(`el-row`),X=e(`el-radio-button`),Z=e(`el-radio-group`),Q=e(`el-table-column`),$=e(`el-tag`),ee=e(`el-table`),te=e(`el-pagination`),ne=v(`loading`);return y(),m(`div`,S,[_(`div`,C,[d(K,{inline:!0,model:c.filterForm,class:`filter-form`},{default:n(()=>[d(x,{label:`系统选择`},{default:n(()=>[d(b,{modelValue:c.filterForm.systemId,"onUpdate:modelValue":o[0]||=e=>c.filterForm.systemId=e,placeholder:`全部系统`,clearable:``},{default:n(()=>[(y(!0),m(l,null,a(c.systemList,e=>(y(),u(g,{key:e.id,label:e.name,value:e.id},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),d(x,{label:`时间范围`},{default:n(()=>[d(W,{modelValue:c.filterForm.dateRange,"onUpdate:modelValue":o[1]||=e=>c.filterForm.dateRange=e,type:`daterange`,"range-separator":`至`,"start-placeholder":`开始日期`,"end-placeholder":`结束日期`,"value-format":`YYYY-MM-DD`},null,8,[`modelValue`])]),_:1}),d(x,{label:`统计粒度`},{default:n(()=>[d(b,{modelValue:c.filterForm.granularity,"onUpdate:modelValue":o[2]||=e=>c.filterForm.granularity=e,placeholder:`请选择`},{default:n(()=>[d(g,{label:`按天`,value:`day`}),d(g,{label:`按周`,value:`week`}),d(g,{label:`按月`,value:`month`})]),_:1},8,[`modelValue`])]),_:1}),d(x,null,{default:n(()=>[d(G,{type:`primary`,onClick:c.handleQuery},{default:n(()=>[...o[6]||=[_(`i`,{class:`fa fa-search`},null,-1),f(` 查询 `,-1)]]),_:1},8,[`onClick`]),d(G,{onClick:c.handleReset},{default:n(()=>[...o[7]||=[_(`i`,{class:`fa fa-refresh`},null,-1),f(` 重置 `,-1)]]),_:1},8,[`onClick`])]),_:1})]),_:1},8,[`model`])]),_(`div`,w,[d(Y,{gutter:20},{default:n(()=>[d(J,{span:6},{default:n(()=>[d(q,{shadow:`hover`,class:`stat-card`},{default:n(()=>[_(`div`,T,[o[9]||=_(`div`,{class:`stat-icon`,style:{background:`linear-gradient(135deg, #409EFF 0%, #66b1ff 100%)`}},[_(`i`,{class:`fa fa-bolt`})],-1),_(`div`,E,[_(`div`,D,r(c.stats.totalConsumption.toFixed(2)),1),o[8]||=_(`div`,{class:`stat-label`},`总能耗 (kWh)`,-1)])])]),_:1})]),_:1}),d(J,{span:6},{default:n(()=>[d(q,{shadow:`hover`,class:`stat-card`},{default:n(()=>[_(`div`,O,[o[11]||=_(`div`,{class:`stat-icon`,style:{background:`linear-gradient(135deg, #67c23a 0%, #85ce61 100%)`}},[_(`i`,{class:`fa fa-line-chart`})],-1),_(`div`,k,[_(`div`,A,r(c.stats.avgDailyConsumption.toFixed(2)),1),o[10]||=_(`div`,{class:`stat-label`},`日均能耗 (kWh)`,-1)])])]),_:1})]),_:1}),d(J,{span:6},{default:n(()=>[d(q,{shadow:`hover`,class:`stat-card`},{default:n(()=>[_(`div`,j,[o[13]||=_(`div`,{class:`stat-icon`,style:{background:`linear-gradient(135deg, #e6a23c 0%, #f0c78a 100%)`}},[_(`i`,{class:`fa fa-arrows-h`})],-1),_(`div`,M,[_(`div`,N,r(c.stats.peakValue.toFixed(2)),1),o[12]||=_(`div`,{class:`stat-label`},`峰值能耗 (kWh)`,-1)])])]),_:1})]),_:1}),d(J,{span:6},{default:n(()=>[d(q,{shadow:`hover`,class:`stat-card`},{default:n(()=>[_(`div`,P,[o[15]||=_(`div`,{class:`stat-icon`,style:{background:`linear-gradient(135deg, #f56c6c 0%, #f89898 100%)`}},[_(`i`,{class:`fa fa-tachometer`})],-1),_(`div`,F,[_(`div`,I,r(c.stats.avgLoadRate)+`%`,1),o[14]||=_(`div`,{class:`stat-label`},`平均负载率`,-1)])])]),_:1})]),_:1})]),_:1})]),_(`div`,L,[d(Y,{gutter:20},{default:n(()=>[d(J,{span:16},{default:n(()=>[d(q,{shadow:`hover`},{header:n(()=>[_(`div`,R,[o[18]||=_(`span`,null,`能耗趋势分析`,-1),d(Z,{modelValue:c.chartType,"onUpdate:modelValue":o[3]||=e=>c.chartType=e,size:`small`},{default:n(()=>[d(X,{label:`line`},{default:n(()=>[...o[16]||=[f(`折线图`,-1)]]),_:1}),d(X,{label:`bar`},{default:n(()=>[...o[17]||=[f(`柱状图`,-1)]]),_:1})]),_:1},8,[`modelValue`])])]),default:n(()=>[_(`div`,z,null,512)]),_:1})]),_:1}),d(J,{span:8},{default:n(()=>[d(q,{shadow:`hover`},{header:n(()=>[...o[19]||=[_(`span`,null,`系统能耗占比`,-1)]]),default:n(()=>[_(`div`,B,null,512)]),_:1})]),_:1})]),_:1})]),_(`div`,V,[d(q,{shadow:`hover`},{header:n(()=>[_(`div`,H,[o[21]||=_(`span`,null,`能耗详情列表`,-1),d(G,{type:`primary`,size:`small`,onClick:c.handleExport},{default:n(()=>[...o[20]||=[_(`i`,{class:`fa fa-download`},null,-1),f(` 导出报表 `,-1)]]),_:1},8,[`onClick`])])]),default:n(()=>[t((y(),u(ee,{data:c.energyData,stripe:``},{default:n(()=>[d(Q,{prop:`date`,label:`日期`,width:`120`}),d(Q,{prop:`systemName`,label:`系统名称`,width:`180`}),d(Q,{prop:`consumption`,label:`能耗 (kWh)`,width:`120`,align:`right`},{default:n(e=>[_(`span`,null,r(e.row.consumption.toFixed(2)),1)]),_:1}),d(Q,{prop:`peakPower`,label:`峰值功率 (kW)`,width:`130`,align:`right`},{default:n(e=>[_(`span`,null,r(e.row.peakPower.toFixed(2)),1)]),_:1}),d(Q,{prop:`avgPower`,label:`平均功率 (kW)`,width:`130`,align:`right`},{default:n(e=>[_(`span`,null,r(e.row.avgPower.toFixed(2)),1)]),_:1}),d(Q,{prop:`loadRate`,label:`负载率 (%)`,width:`100`,align:`center`},{default:n(e=>[d($,{type:c.getLoadRateType(e.row.loadRate)},{default:n(()=>[f(r(e.row.loadRate)+`%`,1)]),_:2},1032,[`type`])]),_:1}),d(Q,{prop:`cost`,label:`预估费用 (元)`,width:`120`,align:`right`},{default:n(e=>[_(`span`,null,`¥`+r(e.row.cost.toFixed(2)),1)]),_:1})]),_:1},8,[`data`])),[[ne,c.loading]]),_(`div`,U,[d(te,{"current-page":c.pagination.currentPage,"onUpdate:currentPage":o[4]||=e=>c.pagination.currentPage=e,"page-size":c.pagination.pageSize,"onUpdate:pageSize":o[5]||=e=>c.pagination.pageSize=e,"page-sizes":[10,20,50,100],total:c.pagination.total,layout:`total, sizes, prev, pager, next, jumper`,onSizeChange:c.handleSizeChange,onCurrentChange:c.handleCurrentChange},null,8,[`current-page`,`page-size`,`total`,`onSizeChange`,`onCurrentChange`])])]),_:1})])])}var G=h(x,[[`render`,W],[`__scopeId`,`data-v-5f1e96c6`]]);export{G as default};